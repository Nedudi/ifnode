<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="UTF-8">
        <title>ifnode - Excellent Node.js Framework</title>
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <meta name="description" content="The ifnode is a simple, flexible, super-light and pluginnable node.js framework. Allows to start developing of application right after of module install.">
        <link rel="stylesheet" type="text/css" href="/assets/css/open-sans.css?v=1.6.0" media="screen">
        <link rel="stylesheet" type="text/css" href="/assets/css/prism-default.css?v=1.6.0" media="screen">
        <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css?v=1.6.0" media="screen">
        <link rel="stylesheet" type="text/css" href="/assets/css/main.css?v=1.6.0" media="screen">
    </head>
    <body>
        <header class="page-header">
            <div class="project-name">
                <a href="/">ifnode</a>
            </div>
            <div class="project-tagline">Simple, flexible, super-light and pluginnable framework</div>
            <div class="project-buttons">
                <a href="https://github.com/ifnode/ifnode" class="btn">View on GitHub</a>
            </div>
        </header>
        <main class="main main--m docs">
            <aside id="toc">
    <ul>
<li><a href="/docs">Guide</a><ul>
<li><a href="/docs/intro">Introduction</a><ul>
<li><a href="/docs/intro/ideology">Ideology</a></li>
</ul>
</li>
<li><a href="/docs/install">Install</a></li>
<li><a href="/docs/app">Application Items</a><ul>
<li><a href="/docs/app/structure">Structure</a></li>
<li><a href="/docs/app/file">app.js</a></li>
<li><a href="/docs/app/config">Config</a><ul>
<li><a href="/docs/app/config/default">Default config</a></li>
<li><a href="/docs/app/config/middleware">Middleware</a></li>
</ul>
</li>
<li><a href="/docs/app/extensions">Extensions</a></li>
<li><a href="/docs/app/models">Models</a></li>
<li><a href="/docs/app/components">Components</a></li>
<li><a href="/docs/app/controllers">Controllers</a></li>
<li><a href="/docs/app/plugins">Plugins</a><ul>
<li><a href="/docs/app/plugins/component">component</a></li>
<li><strong>controller</strong></li>
<li><a href="/docs/app/plugins/schema">schema</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="/api">API</a><ul>
<li>Constants<ul>
<li><a href="/api/plugin_types">PLUGIN_TYPES</a><ul>
<li><a href="/api/plugin_types#schema">.SCHEMA</a></li>
<li><a href="/api/plugin_types#component">.COMPONENT</a></li>
<li><a href="/api/plugin_types#controller">.CONTROLLER</a></li>
</ul>
</li>
</ul>
</li>
<li>Interfaces<ul>
<li><a href="/api/iconnectionserver">IConnectionServer</a><ul>
<li><a href="/api/iconnectionserver#iconnectionserver-constructor">#constructor</a></li>
<li><a href="/api/iconnectionserver#iconnectionserver-configure">#configure</a></li>
<li><a href="/api/iconnectionserver#iconnectionserver-listen">#listen</a></li>
<li><a href="/api/iconnectionserver#iconnectionserver-close">#close</a></li>
</ul>
</li>
</ul>
</li>
<li>Classes<ul>
<li><a href="/api/ifnode">IFNode</a></li>
<li><a href="/api/application">Application</a><ul>
<li><a href="/api/application#application-constructor">Constructor</a></li>
<li>Properties<ul>
<li><a href="/api/application#application-id">.id</a></li>
<li><a href="/api/application#application-alias">.alias</a></li>
<li><a href="/api/application#application-project_folder">.project_folder</a></li>
<li><a href="/api/application#application-project_folder">.projectFolder</a></li>
<li><a href="/api/application#application-backend_folder">.backend_folder</a></li>
<li><a href="/api/application#application-backend_folder">.backendFolder</a></li>
<li><a href="/api/application#application-config">.config</a></li>
<li><a href="/api/application#application-listener">.listener</a></li>
<li><a href="/api/application#application-connection">.connection</a></li>
<li><em><a href="/api/application#application-server">.server <sup>deprecated</sup></a></em></li>
<li><a href="/api/application#application-models">.models</a></li>
<li><a href="/api/application#application-components">.components</a></li>
<li><a href="/api/application#application-controllers">.controllers</a></li>
</ul>
</li>
<li>Methods<ul>
<li><a href="/api/application#application-require">.require</a></li>
<li><a href="/api/application#application-register">.register</a></li>
<li><a href="/api/application#application-load">.load</a></li>
<li><a href="/api/application#application-extension">.extension</a></li>
<li><em><a href="/api/application#application-extension">.ext <sup>deprecated</sup></a></em></li>
<li><a href="/api/application#application-component">.component</a></li>
<li><em><a href="/api/application#application-run">.run <sup>deprecated</sup></a></em></li>
<li><em><a href="/api/application#application-down">.down <sup>deprecated</sup></a></em></li>
<li><a href="/api/application#application-model-class">.Model</a></li>
<li><em><a href="/api/application#application-component-class">.Component <sup>deprecated</sup></a></em></li>
<li><a href="/api/application#application-controller-class">.Controller</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/api/model">Model</a><ul>
<li><a href="/api/model#model-constructor">Constructor</a></li>
</ul>
</li>
<li><a href="/api/component">Component</a><ul>
<li><a href="/api/component#component-constructor">Constructor</a></li>
<li>Properties<ul>
<li><a href="/api/component#component-id">.id</a></li>
<li><a href="/api/component#component-name">.name</a></li>
<li><a href="/api/component#component-config">.config</a></li>
<li><a href="/api/component#component-alias">.alias</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/api/controller">Controller</a><ul>
<li>Static methods<ul>
<li><a href="/api/controller#process_config">.process_config</a></li>
<li><a href="/api/controller#process_config">.processConfig</a></li>
<li><a href="/api/controller#populate">.populate</a></li>
<li><a href="/api/controller#middleware">.middleware</a></li>
</ul>
</li>
<li><a href="/api/controller#constructor">Constructor</a></li>
<li>Properties<ul>
<li><a href="/api/controller#controller-id">.id</a></li>
<li><a href="/api/controller#controller-name">.name</a></li>
<li><a href="/api/controller#controller-root">.root</a></li>
<li><a href="/api/controller#controller-router">.router</a></li>
<li><a href="/api/controller#controller-map">.map</a></li>
</ul>
</li>
<li>Methods<ul>
<li><a href="/api/controller#before">.before</a></li>
<li><a href="/api/controller#param">.param</a></li>
<li><a href="/api/controller#method">.method</a></li>
<li><a href="/api/controller#method-get">.get</a></li>
<li><a href="/api/controller#method-post">.post</a></li>
<li><a href="/api/controller#method-put">.put</a></li>
<li><a href="/api/controller#method-patch">.patch</a></li>
<li><a href="/api/controller#method-delete">.delete</a></li>
<li><em><a href="/api/controller#method-del">.del <sup>deprecated</sup></a></em></li>
<li><a href="/api/controller#use">.use</a></li>
<li><a href="/api/controller#end">.end</a></li>
<li><a href="/api/controller#error">.error</a></li>
</ul>
</li>
<li>Request property<ul>
<li><a href="/api/controller#request-data">req.data</a></li>
</ul>
</li>
<li>Response methods<ul>
<li><a href="/api/controller#response-ok">res.ok</a></li>
<li><a href="/api/controller#response-bad_request">res.bad_request</a></li>
<li><a href="/api/controller#response-bad_request">res.badRequest</a></li>
<li><a href="/api/controller#response-bad_request">res.fail</a></li>
<li><a href="/api/controller#response-unauthorized">res.unauthorized</a></li>
<li><a href="/api/controller#response-forbidden">res.forbidden</a></li>
<li><a href="/api/controller#response-not_found">res.not_found</a></li>
<li><a href="/api/controller#response-not_found">res.notFound</a></li>
<li><a href="/api/controller#response-error">res.error</a></li>
<li><a href="/api/controller#response-error">res.err</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

</aside>
<section id="docs">
    <h1 id="controller-plugin">Controller plugin <a href="#controller-plugin"><span>#</span></a></h1>
<p>Possibility to create own controller plugin to <code>ifnode</code>.</p>
<h2 id="creating-own-plugin">Creating own plugin <a href="#creating-own-plugin"><span>#</span></a></h2>
<p>Below example of simple plugin <code>ip-filter</code> for filter access by user ip.</p>
<p>Plugin file:</p>
<pre><code class="lang-javascript"><span class="token comment" spellcheck="true">// extensions/ip-filter</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>controller <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> Controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// check needed controller plugin options</span>
    Controller<span class="token punctuation">.</span><span class="token function">process_config</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>controller_config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_invalid_ip</span><span class="token punctuation">(</span>controller_config<span class="token punctuation">.</span>forbidden_ip<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">delete</span> controller_config<span class="token punctuation">.</span>forbidden_ip<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_invalid_ip</span><span class="token punctuation">(</span>controller_config<span class="token punctuation">.</span>skip_ip<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">delete</span> controller_config<span class="token punctuation">.</span>skip_ip<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// populate by own methods/properties request or response</span>
    Controller<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> next_handler<span class="token punctuation">,</span> next_route<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        request<span class="token punctuation">.</span>user_ip <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'x-forwarded-for'</span><span class="token punctuation">]</span> <span class="token operator">||</span>
            request<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>remoteAddress <span class="token operator">||</span>
            request<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>remoteAddress <span class="token operator">||</span>
            request<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>remoteAddress<span class="token punctuation">;</span>

        response<span class="token punctuation">.</span>forbidden_ip_address <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Access denied for user's ip"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token function">next_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// set controller middleware</span>
    Controller<span class="token punctuation">.</span><span class="token function">middleware</span><span class="token punctuation">(</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span>controller_options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> forbidden_ip <span class="token operator">=</span> controller_options<span class="token punctuation">.</span>forbidden_ip<span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> next_handler<span class="token punctuation">,</span> next_route<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>user_ip <span class="token operator">===</span> forbidden_id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">forbidden_ip_address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token function">next_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span>controller_options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> skip_ip <span class="token operator">=</span> controller_options<span class="token punctuation">.</span>skip_ip<span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> next_handler<span class="token punctuation">,</span> next_route<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>user_ip <span class="token operator">===</span> skip_ip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token function">next_route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// jump to next route</span>
                <span class="token punctuation">}</span>

                <span class="token function">next_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Controller file:</p>
<pre><code class="lang-javascript"><span class="token comment" spellcheck="true">// controllers/!.js</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ifnode'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    main_controller <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">Controller</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        forbidden_ip<span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

main_controller<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span> skip_ip<span class="token punctuation">:</span> <span class="token string">'10.10.10.1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get handler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
main_controller<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'use handler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Test case:</p>
<pre><code>curl localhost:8080 -H x-forwarded-for=127.0.0.1 # status 401, Access denied for user&#39;s ip
curl localhost:8080 -H x-forwarded-for=10.10.10.1 # status 200, use handler
</code></pre><h2 id="example">Example <a href="#example"><span>#</span></a></h2>
<ul>
<li><strong><a href="https://github.com/ifnode/auth">ifnode-auth</a></strong></li>
</ul>

</section>
<section id="toc-page">
    <a href="/toc">Table of Content</a>
</section>

        </main>
        <footer class="page-footer">
            <span class="owner">
                <a href="https://github.com/ifnode/ifnode">ifnode</a> is maintained by <a href="https://github.com/ilfroloff">Ilya Frolov</a> ©
            </span>
        </footer>
    </body>
</html>
