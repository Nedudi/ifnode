# app.Controller

Returns controller instance:

```javascript
app.Controller([Object options])
```

Controller can be extended by external plugins (example: `ifnode-auth`, `ifnode-permissions` etc)

## Default parameters

Option | Type | Description | Optional | Default
:------ | :---- | :----------- | :-------- | :-------
root | String | Root path to request | true | `/path/to/controller/` related `${backend_folder}`
name | String | Name of controller | true | `path/to/controller` related `${backend_folder}`
router | Object | `express.Router` options. Check [here](https://expressjs.com/4x/api.html#router) | true | `{}`
ajax | Undefined &#10072; Boolean | AJAX settings of controller's actions | true | undefined


## Controller instance

### Constants

Option | Type | Description
:------ | :---- | :-----------
.id | String | Application id (is auto-generated by GUID function)
.root | String | Controller's root path
.name | String | Controller's name
.router | [Router] | `express.Router()` instance

### Methods

Option | Description
:------ | :-----------
.param(String param, Function handler) | Analog of express`s `app.param`. Check [here](https://expressjs.com/4x/api.html#app.param)
[[.method(String method [, String path] [, Object options], Function callback [, Function callback...])|docs/api/app/controller/.method]] | Method for creating controller's route
.end() | End of controller (if request cannot have handler invoke `response.not_found()` method. By default go to next controller to find request handler)
.use([String path,] Function callback [, Function callback...]) | Check [here](https://expressjs.com/4x/api.html#app.use)
.error(Function handler) | Invoke `.error()` handler when any request handler's `next()` method of controller get instance of `Error` class. By default try find parent error handler, and if not find throw error in `node.js`

### Handler options

All handlers `request` and `response` methods populated by same custom options:

#### request

Option | Description
------ | -----------
.data | "Syntax sugar". Return `request.body`, or `request.query` or `null`


#### response

Option | Description
------ | -----------
.ok([String &#10072; Object data]) | Set status `200` and return `data`
<a name="response-fail">.fail([String &#10072; Object data])</a> | Set status `400` and return `data` or text "Bad Request"
<a name="response-error">.error([String &#10072; Object data])</a> | Set status `500` and return `data` or text "Server Internal Error"
.unauthorized([String &#10072; Object data]) | Set status `401` and return `data`
.forbidden([String &#10072; Object data]) | Set status `403` and return `data`
<a name="response-notfound">.not_found([String &#10072; Object data])</a> | Set status `404` and return `data`

Aliases:

Option | Description
------ | -----------
[.bad_request()](#response-fail) | Alias of `.fail()`
[.badRequest()](#response-fail) | Alias of `.fail()`
[.err()](#response-error) | Alias of `.error()`
[.notFound()](#response-notfound) | Alias of `.not_found()`

### Notes

Controller's filename `!.js` and `~.js` are special. Those filenames not participate in forming name and root options.

`!.js:` always initialize first in folder. Next loaded controllers into folders, and next files
`~.js:` always initialize last in folder

Example:

```javascript
// /protected/controllers/api/v1/!.js
var controller = app.Controller();
controller.name // api/v1
controller.root // /api/v1/

// /protected/controllers/api/v1/user.js
var controller = app.Controller({
    root: '/user'
});
controller.name // api/v1/user
controller.root // /user
```

Static methods (use for creating controller's plugin):

Option | Description
------ | -----------
.process_config(...Function processor &#10072; Array processors) | Add handler for controller`s config
.populate(...Function populator &#10072; Array populators) | Add route middleware for populate arguments own options
.middleware(...Function middleware &#10072; Array middleware) | Add route middleware for process request

## app.Controller#.method

### Parameters

Argument | Description | Default
:-------- | :----------- | :-------
method | Name of method. Current available: get, post, put, patch, delete | -
path | Next part of url. Check [here](https://expressjs.com/4x/api.html#router.METHOD). Instead of express's variant of set, cannot be regular expression | `/`
options | Special options for route | Equal to [controller's options](#default-parameters) omit `root`, `name` and `router`
callback | Handler(s) of request |

"Syntax sugar" for `.method()`:

```javascript
.get()
.post()
.put()
.patch()
.delete()
.del()
```